version: '3.8'

services:
  banhammer-lite:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: banhammer-lite
    restart: unless-stopped
    ports:
      - "${TCP_PORT:-9999}:${TCP_PORT:-9999}"
      - "${API_PORT:-8080}:${API_PORT:-8080}"
    environment:
      - TCP_HOST=${TCP_HOST:-0.0.0.0}
      - TCP_PORT=${TCP_PORT:-9999}
      - API_HOST=${API_HOST:-0.0.0.0}
      - API_PORT=${API_PORT:-8080}
      - API_TOKEN=${API_TOKEN:-}
      - PANEL_URL=${PANEL_URL}
      - PANEL_TOKEN=${PANEL_TOKEN}
      - PANEL_RELOAD_INTERVAL=${PANEL_RELOAD_INTERVAL:-300}
      # Detection settings
      - CONCURRENT_WINDOW=${CONCURRENT_WINDOW:-2}
      - TRIGGER_PERIOD=${TRIGGER_PERIOD:-30}
      - TRIGGER_COUNT=${TRIGGER_COUNT:-5}
      - BANLIST_THRESHOLD_SECONDS=${BANLIST_THRESHOLD_SECONDS:-300}
      - DATA_RETENTION_SECONDS=${DATA_RETENTION_SECONDS:-300}
      - SUBNET_GROUPING=${SUBNET_GROUPING:-false}
      - WHITELIST_EMAILS=${WHITELIST_EMAILS:-}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    networks:
      - default
      - panel-net

networks:
  panel-net:
    external: true
    name: ${PANEL_NETWORK:-remnawave-network}
